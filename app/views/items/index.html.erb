<% provide(:title, "All Items")%>

<main class="page-body">
<%= render "shared/flash" %>

  <div class="d-flex justify-content-between">
    <div>
      <%= search_form_for @q do |f| %> 
        <div class="input-group">
          <div class="form-outline">
            <%= f.text_field :name_cont, class: 'form-control', placeholder: 'search by name' %> 
          </div>
          <%= f.submit class: 'btn btn-secondary' %>
        </div>
      <%end%>
    </div>
    <div>
      <%= search_form_for @q do |f| %> 
        <div class="input-group">
          <div class="form-outline">
          <%= f.collection_select :brand_name_cont, Brand.all,  :name, :name, {include_blank: '--filter by brand--'}, {class: 'form-control'} %> 
          </div>
          <%= f.submit 'apply', class: 'btn  btn-sm btn-secondary' %>
        </div>
      <%end%>
    </div>

    <div>
      <% if current_user.admin %>
        <%= link_to "Add Item", new_item_path, class:"btn btn-primary" %>
      <% end %>
    </div>    
  </div>

  <br/>


    <h2>Item List</h2>
    <div id="items">
     <% if !@items.empty? %>
        <table class="table table-striped table-hover table-bordered text-center">
          <thead class="table-dark">
            <tr>
              <th><%= sort_link(@q, :name, 'Item Name', class: "text-white") %></th>
              <th>Brand Name</th>
              <th><%= sort_link(@q, :in_stock, 'Current Scock', class: "text-white") %></th>
              <th><%= sort_link(@q, :total_stock, 'Total Scock', class: "text-white") %></th>
              <th><%= sort_link(@q, :price, 'Unit Price', class: "text-white") %></th>

              <% if current_user.admin %>
                <th colspan="3"></th>
              <% else %>
                <th></th>
              <% end %>
            </tr>
          </thead>
          <tbody> 
            <% @items.each do |item| %>
                <tr>
                  <td><%= item.name %></td>
                  <td><%= get_brand_name_by_id item.brand_id %></td>
                  <td><%= item.in_stock %></td>
                  <td><%= item.total_stock %></td>
                  <td><%= item.price %></td>

                <% if current_user.admin %>
                  <td>
                    <div class=" dropdown">
                    <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                      Show
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                      <li>
                          <%= link_to "Details", item, class: "btn btn-link" %>
                      </li>
                      <li>
                          <%= link_to "Allotments", item_allotments_item_path(item), class: "btn btn-link" %>
                      </li>                    
                    </ul>
                  </div>
                  </td>
                <% else %>
                  <td>
                    <%= link_to "Show", item, class: "btn btn-primary" %>
                  </td>
                <% end %>
                <% if current_user.admin %>
                  <td>
                    <div class=" dropdown">
                    <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                      Update
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                      <li>
                          <%= link_to "Add New Stock", new_stock_item_path(item), class: "btn btn-link" %>
                      </li>
                      <li>
                          <%= link_to "Edit Item", edit_item_path(item), class: "btn btn-link"%>
                      </li>                    
                    </ul>
                  </div>
                  </td>
                    

                  <td><%= link_to "Delete", item, method: :delete, data: {confirm: "Are you sure?" }, class: "btn btn-danger" %></td>
                <% end %> 
                </tr> 
            <% end %>        
          </tbody>    
        </table> 
      <% else %>
        <p class="text-center">No Items found! <br/>
        Click Add Item button to add new item.</p>
      <% end %>
    </div>
</main>
  